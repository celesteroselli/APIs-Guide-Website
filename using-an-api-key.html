<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>APIs Guide</title>
    <link href="styles.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300..700&family=Oxanium:wght@200..800&display=swap" rel="stylesheet">
  </head>

  <body>
    <div class="flexbox">
    <!--rly want to use svelte for templating bc if not this will be a mess-->
    <div id="sidebar">
        <ul id="nav">
            <li class="main-level"><a href="/">Home</a></li>
            <li><a href="/info.html">More about APIs</a></li>
            
            <li class="main-level"><a href="/getting-started.html">CatAPI</a></li>
            <li><a href="/getting-started.html">Getting started</a></li>
            <li><a href="/using-an-api.html">Using the API to get images</a></li>

            <li class="main-level"><a href="/api-key.html">API Keys</a></li>
            <li><a href="/api-key.html">Getting an API key</a></li>
            <li id="current"><a href="/using-an-api-key.html">Using an API key</a></li>

            <li class="main-level"><a href="/other-apis.html">Other APIs</a></li>
        </ul>
    </div>
    <div id="main-content">
        <h1>using an API key (requires a framework)</h1>
        <p>Now that you've learned how to use an API without an API key, here's a guide on using one with an API key. </p>
        <p>You can learn more about API keys <a target="_blank" href="info.html">here</a>. </p>
        <p>When using an API key, its really important to keep it a secret. One of the ways we can do this in public codebases (such as a public repository on GitHub) is use environmental variables (**this is only available with frameworks, not vanilla Javascript). </p>
        <p>This guide will cover using a .env file to store an API key for testing, then deploying on Vercel with an API key as an environmental variable. </p>
        <h2>calling an API with a key</h2>
        <h3>Locally (for building and testing)</h3>
        <p>Setting up a .env file and adding it to the .gitignore allows you to make your codebase public while keeping an API key private and stored locally on your device. </p>
        <p>First, add a .gitignore file to your repository. If you're working in VS code, you can follow the guide below to create and modify each file. Please note that your file tree will look very different from mine, since you're in an Astro project. </p>
        <img width="400" src="images/add_file_button_vs_code.png">
        <img width="400" src="images/adding_a_.gitignore_vs_code.png">
        <p>Then, add the filename ".env" to your .gitignore. This will tell git to ignore the file and not commit it to the repository, which allows it to stay local on your computer. </p>
        <img width="400" src="images/adding_the_.env_to_the_.gitignore_in_vs_code.png">
        <p>Now, create a .env file: </p>
        <img width="400" src="images/adding_a_.env_vs_code.png">
        <p>And add your API key to it. Do not include quotes around it! If you still have your API key from CatAPI in your email, that's great! If not, just copy it again from their email. </p>
        <img width="400" src="images/edited_api_key_in_.env.png">
        <p>Note: your .env file should be in the root of your repository, along with the .gitignore. </p>
        <p>Now, you can access this API key locally. Use the code below in your Javascript at the top of your file: </p>
        <p class="code">const api_key = import.meta.env.API_KEY</p>
        <p>You can now use the API key just as you would any other variable! </p>
        <h3>Calling the API</h3>
        <p>Now that you've created a variable for your API key and know how to access it, here's how to call CatAPI using it. </p>
        <p>One simple way to do this is to take the previous code (with the fetch statement and json conversion) and simply add "&api_key={your_api_key}" to the end. </p>
        <p>Like before in vanilla JS, we'll be using fetch and .json() to get our data and convert it into a usable format. First, at the top of your file (between the two --- and beneath your API key variable declaration), add the below code. The ` will allow you to insert your api key variable directly into the url! </p>
        <p class="code">const catapi_raw_data = await fetch(<br>&#9;`https://api.thecatapi.com/v1/images/search?breed_ids=beng&api_key=${api_key}`<br>)</p>
        <p>You can also call the API using a header for the API key, which is more common. You can implement it like this: </p>
        <p class="code">const catapi_raw_data = await fetch('https://api.thecatapi.com/v1/images/search?breed_ids=beng',{<br>&#9;headers: {<br>&#9;&#9;'x-api-key': api_key<br>&#9;}<br>})</p>
        <p>Now, like before, we have to convert this request to a JSON format using .json(). </p>
        <p class="code">const catapi_json = await catapi_raw_data.json()</p>
        <p>Looking at the above URL, you can see that this request only searches for images of bengals! Please note that this functionality is <u>also available without an API key</u>, but I'm using it to demo how you may call an API which does require an API key. </p>
        <p>The first argument (the breed) is separated from the URL by a ?, and following ones with &s. These arguments allow us to customize what the API gives us! Another you can experiment with is limit=#, which allows you to define the number of images the API will return. If you are returning multiple images, you will also have to change your code so that it displays more than one image! </p>
        <p>Finally, in your code, you can add an image tag with an src defined by catapi_json[0].url</p>
        <p class="code">&#60;img src={catapi_json[0].url}&#62;</p>
        <p>You may have to set the width so that it fits on your screen, but don't set both the width and the height otherwise it may distort the image! Alternatively, you can set the width and the height to the width and heights given by the api through .width and .height. </p>
        <p>Finally, run your app with "npm run dev" and you should see a cat image on the webpage! If you re-start the server, another one will appear. </p>
        <h3>Deployment: Vercel</h3>
        <p class="important">Question: is it necessary to set up live reload for the API in Vercel, or is a one-time fetch at build okay? </p>
        <p>When you're ready to share your website with the world, you can set it up to deploy on Vercel! </p>
        <p>First, head to <a href="https://vercel.com/" target="_blank">vercel.com</a>. </p>
        <p>Then, create a new project. </p>
        <img width="500" src="images/vercel_add_new_project_better.png">
        <p>Select your GitHub repository (make sure all of your changes are committed!)</p>
        <img width="500" src="images/selecting_github_project_in_vercel.png">
        <p>Astro should be auto-detected (see first screenshot below)</p>
        <img width="500" src="images/astro_preset_displaying_correctly.png">
        <p>However, if your Vercel screen looks like the below: </p>
        <img width="500" src="images/astro_not_auto-detecting.png">
        <p>You may have to change the root directory following the image below. Select a subfolder if it auto-detects as Astro! </p>
        <img width="500" src="images/change_to_auto-detect_astro_subfolder.png">
        <p>Now, your project should display as Astro on Vercel! </p>
        <p>After that, set the API key using your .env if you can find it in file explorer (illustrated below), or if you can't just copy it again from your email and manually enter it. </p>
        <img width="500" src="images/adding_a_.env_to_vercel.png">
        <p>Finally, you're ready to deploy! Just click deploy and your website should go up on a stable URL. You did it! This process can be followed for any other API and should be used whenever an API requires an API key. </p>
        <a style="width: 60px;" class="button" href="/">go home</a>
        <p>or</p>
        <a style="width: 220px;" class="button" href="/other-apis.html">check out some other cool apis! </a>
    </div>
    </div>
    <script src="index.js"></script>
  </body>
</html>